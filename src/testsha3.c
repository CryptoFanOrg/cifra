#include "sha3.h"
#include "handy.h"
#include "cutest.h"
#include "testutil.h"

static void vector(const cf_chash *H, const char *msgstr, const char *hashstr)
{
  uint8_t message[128];
  uint8_t expecthash[64], hash[64];

  size_t nmessage = unhex(message, sizeof message, msgstr);
  size_t nexpecthash = unhex(expecthash, sizeof expecthash, hashstr);

  assert(nexpecthash == H->hashsz);

  cf_chash_ctx ctx;
  assert(sizeof(ctx) >= H->ctxsz);
  H->init(&ctx);
  H->update(&ctx, message, nmessage);
  H->digest(&ctx, hash);

  TEST_CHECK(memcmp(hash, expecthash, nexpecthash) == 0);
}

static void test_sha3_256(void)
{
  const cf_chash *H = &cf_sha3_256;
  vector(H, "", "C5D2460186F7233C927E7DB2DCC703C0E500B653CA82273B7BFAD8045D85A470");
  vector(H, "CC", "EEAD6DBFC7340A56CAEDC044696A168870549A6A7F6F56961E84A54BD9970B8A");
  vector(H, "41FB", "A8EACEDA4D47B3281A795AD9E1EA2122B407BAF9AABCB9E18B5717B7873537D2");
  vector(H, "5BE43C90F22902E4FE8ED2D3", "0F53BE55990780B3FAD9870F04F7D8153C3AE605C057C85ABB5D71765043AAA8");
  vector(H, "AECBB02759F7433D6FCB06963C74061CD83B5B3FFA6F13C6", "2329810B5A4735BCD49C10E6456C0B1DED5EAC258AF47CBB797CA162AB6D1BA8");
  vector(H, "0F8B2D8FCFD9D68CFFC17CCFB117709B53D26462A3F346FB7C79B85E", "AEEF4B4DA420834FFCED26DB291248FB2D01E765E2B0564057F8E6C2030AC37F");
  vector(H, "D8FABA1F5194C4DB5F176FABFFF856924EF627A37CD08CF55608BBA8F1E324D7C7F157298EABC4DCE7D89CE5162499F9", "AD55537347B20D9FCA02683E6DE1032EC10EB84DA4CBD501E49744A666292EDF");
  vector(H, "E926AE8B0AF6E53176DBFFCC2A6B88C6BD765F939D3D178A9BDE9EF3AA131C61E31C1E42CDFAF4B4DCDE579A37E150EFBEF5555B4C1CB40439D835A724E2FAE7", "574271CD13959E8DDEAE5BFBDB02A3FDF54F2BABFD0CBEB893082A974957D0C1");
  vector(H, "2B6DB7CED8665EBE9DEB080295218426BDAA7C6DA9ADD2088932CDFFBAA1C14129BCCDD70F369EFB149285858D2B1D155D14DE2FDB680A8B027284055182A0CAE275234CC9C92863C1B4AB66F304CF0621CD54565F5BFF461D3B461BD40DF28198E3732501B4860EADD503D26D6E69338F4E0456E9E9BAF3D827AE685FB1D817", "D82E257D000DC9FA279A00E2961E3286D2FE1C02EF59833AB8A6A7101BC25054");
}

TEST_LIST = {
  { "sha3-256", test_sha3_256 },
  { 0 }
};

